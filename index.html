<!DOCTYPE html>
<html>
    <head> 
    <script src="/math.min.js"></script>
    </head>
    
<body>

<h3>A demonstration of how to access a Slider Control</h3>

<input type="range" id="myRange" value="90">

<p>Click the button to get the value of the slider control.</p>

<button onclick="myFunction()">Try it</button>

<p><strong>Note:</strong> input elements with type="range" are not supported in IE 9 and earlier versions.</p>
    <img id="photo">
<p id="demo"></p>

<script>
var W_decoder0 = 0;
var Wmu_output1 = 0;
var Wmu_output2 = 0;
var beta_decoder0 = 0;
var bmu_output = 0;
var gamma_decoder0 = 0;
var rmean_decoder0 = 0;
var rvar_decoder0 = 0;
var loaded_files = 0;
    
function myMul(W,x) {
    alert("BEGIN!");
    var j = 0;
    var my_arr = new Float32Array(W.length / x.length);
    for (var i = 0; i < W.length/x.length; i++){
        my_arr[i] = 0.0
        j = 0;
        for (j = 0; j < x.length; j++){
            my_arr[i] += W[i*x.length + j];
        }
    }
    alert("END!");
    return my_arr;
}
    function decodeFloat16 (binary) {
    var exponent = (binary & 0x7C00) >> 10;
        fraction = binary & 0x03FF;
    return (binary >> 15 ? -1 : 1) * (
        exponent ?
        (
            exponent === 0x1F ?
            fraction ? NaN : Infinity :
            Math.pow(2, exponent - 15) * (1 + fraction / 0x400)
        ) :
        6.103515625e-5 * (fraction / 0x400)
    );
};

function read_array_16(filename,varname) {
    var oReq = new XMLHttpRequest();
    oReq.open("GET", filename, true);
    oReq.responseType = "arraybuffer";

    oReq.onload = function (oEvent) {
      var arrayBuffer = oReq.response; // Note: not oReq.responseText
      if (arrayBuffer) {
        var dataview = new DataView(arrayBuffer);

        // Create buffer (4 bytes / float)
        var mFloatArray = new Float32Array(arrayBuffer.byteLength / 2);

        // Copy floats
         tmp = 0.0;
        for (var i = 0; i < mFloatArray.length; i++) 
        {
            mFloatArray[i] = decodeFloat16(dataview.getUint16(i * 2,true)); // At every 4th byte
            tmp += mFloatArray[i];
        }
          
          window[varname] = mFloatArray;
          alert(varname + ":" + mFloatArray[0]);
          
          loaded_files += 1;
          alert(loaded_files);
      }
    };

    oReq.send(null);
}

function read_array_32(filename,varname) {
    var oReq = new XMLHttpRequest();
    oReq.open("GET", filename, true);
    oReq.responseType = "arraybuffer";

    oReq.onload = function (oEvent) {
      var arrayBuffer = oReq.response; // Note: not oReq.responseText
      if (arrayBuffer) {
        var dataview = new DataView(arrayBuffer);

        // Create buffer (4 bytes / float)
        var mFloatArray = new Float32Array(arrayBuffer.byteLength / 4);

        // Copy floats
         tmp = 0.0;
        for (var i = 0; i < mFloatArray.length; i++) 
        {
            mFloatArray[i] = dataview.getFloat32(i * 4,true); // At every 4th byte
            tmp += mFloatArray[i];
        }
          
          window[varname] = mFloatArray;
          alert(varname);
          loaded_files += 1;
          alert(loaded_files);
      }
    };

    oReq.send(null);
}


function myFunction() {
   
    read_array_16("/W_decoder0.bin","W_decoder0");
    read_array_16("/Wmu_output1.bin","Wmu_output1");
    read_array_16("/Wmu_output2.bin","Wmu_output2");
    read_array_16("/bmu_output.bin","bmu_output");
    
    read_array_16("/beta_decoder0.bin","beta_decoder0");
    read_array_16("/gamma_decoder0.bin","gamma_decoder0");

    read_array_32("/rmean_decoder0_32.bin","rmean_decoder0");
    read_array_32("/rvar_decoder0_32.bin","rvar_decoder0");
    
}
function hsv_to_rgb(hsv_image){
    rgb_img = new Uint8Array(hsv_image.length);
        
    for (var kk = 0; kk < hsv_image.length/3; kk++){
        var h = hsv_image[kk*3];
        var s = hsv_image[kk*3 + 1];
        var l = hsv_image[kk*3 + 2];
        
        var r, g, b;

        var i = Math.floor(h * 6);
        var f = h * 6 - i;
        var p = v * (1 - s);
        var q = v * (1 - f * s);
        var t = v * (1 - (1 - f) * s);

        switch(i % 6){
            case 0: r = v, g = t, b = p; break;
            case 1: r = q, g = v, b = p; break;
            case 2: r = p, g = v, b = t; break;
            case 3: r = p, g = q, b = v; break;
            case 4: r = t, g = p, b = v; break;
            case 5: r = v, g = p, b = q; break;
        }
        rgb_img[kk*3] = r * 255;
        rgb_img[kk*3 + 1] = g * 255;
        rgb_img[kk*3 + 2] = b*255;
    }
    return rgb_img;
}
    
function drawImage( hsv_img ) {
    var rgb_img = hsv_to_rgb(hsv_img);
   
    var blob = new Blob( [ rgb_img ], { type: "image/jpeg" } );
    var urlCreator = window.URL || window.webkitURL;
    var imageUrl = urlCreator.createObjectURL( blob );
    var img = document.querySelector( "#photo" );
    img.src = imageUrl;
}
</script>

</body>
</html>
