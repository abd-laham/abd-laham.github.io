<!DOCTYPE html>
<html>
    <head> 
    <script src="/math.min.js"></script>
    </head>
    
<body>

<h3>A demonstration of how to access a Slider Control</h3>

<input type="range" id="myRange" value="90">

<p>Click the button to get the value of the slider control.</p>

<button onclick="myFunction()">Try it</button>

<p><strong>Note:</strong> input elements with type="range" are not supported in IE 9 and earlier versions.</p>

<p id="demo"></p>

<script>
var W_decoder0 = 0;
var Wmu_output1 = 0;
var Wmu_output2 = 0;
var beta_decoder0 = 0;
var bmu_output = 0;
var gamma_decoder0 = 0;
var rmean_decoder0 = 0;
var rvar_decoder0 = 0;
var loaded_files = 0;
    
function myMul(W,x) {
    alert("BEGIN!");
    var j = 0;
    var my_arr = new Float32Array(W.length / x.length);
    for (var i = 0; i < W.length/x.length; i++){
        my_arr[i] = 0.0
        j = 0;
        for (j = 0; j < x.length; j++){
            my_arr[i] += W[i*x.length + j];
        }
    }
    alert("END!");
    return my_arr;
}
    function decodeFloat16 (binary) {
    var exponent = (binary & 0x7C00) >> 10;
        fraction = binary & 0x03FF;
    return (binary >> 15 ? -1 : 1) * (
        exponent ?
        (
            exponent === 0x1F ?
            fraction ? NaN : Infinity :
            Math.pow(2, exponent - 15) * (1 + fraction / 0x400)
        ) :
        6.103515625e-5 * (fraction / 0x400)
    );
};

function read_array_16(filename,varname) {
    var oReq = new XMLHttpRequest();
    oReq.open("GET", filename, true);
    oReq.responseType = "arraybuffer";

    oReq.onload = function (oEvent) {
      var arrayBuffer = oReq.response; // Note: not oReq.responseText
      if (arrayBuffer) {
        var dataview = new DataView(arrayBuffer);

        // Create buffer (4 bytes / float)
        var mFloatArray = new Float32Array(arrayBuffer.byteLength / 2);

        // Copy floats
         tmp = 0.0;
        for (var i = 0; i < mFloatArray.length; i++) 
        {
            mFloatArray[i] = decodeFloat16(dataview.getUint16(i * 2,true)); // At every 4th byte
            tmp += mFloatArray[i];
        }
          
          window[varname] = mFloatArray;
          alert(varname + ":" + mFloatArray[0]);
          
          loaded_files += 1;
          alert(loaded_files);
      }
    };

    oReq.send(null);
}

function read_array_32(filename,varname) {
    var oReq = new XMLHttpRequest();
    oReq.open("GET", filename, true);
    oReq.responseType = "arraybuffer";

    oReq.onload = function (oEvent) {
      var arrayBuffer = oReq.response; // Note: not oReq.responseText
      if (arrayBuffer) {
        var dataview = new DataView(arrayBuffer);

        // Create buffer (4 bytes / float)
        var mFloatArray = new Float32Array(arrayBuffer.byteLength / 4);

        // Copy floats
         tmp = 0.0;
        for (var i = 0; i < mFloatArray.length; i++) 
        {
            mFloatArray[i] = dataview.getFloat32(i * 4,true); // At every 4th byte
            tmp += mFloatArray[i];
        }
          
          window[varname] = mFloatArray;
          alert(varname);
          loaded_files += 1;
          alert(loaded_files);
      }
    };

    oReq.send(null);
}


function myFunction() {
    read_array_16("/W_decoder0.bin","W_decoder0");
    read_array_32("/rmean_decoder0_32.bin","rmean_decoder0");
}
</script>

</body>
</html>
